#!/usr/bin/env node
/**
 * CVE Search - NVD API 2.0 Client
 *
 * Searches the National Vulnerability Database for CVEs.
 * Rate limit: 5 requests/30s (public), 50 requests/30s (with API key)
 */
import { parseArgs, validateOptions } from './cli.js';
import { NVDClient } from './api.js';
import { formatCVE, sortBySeverity, getSummary, formatTextReport } from './formatter.js';
async function main() {
    const args = process.argv.slice(2);
    if (args.length === 0 || args.includes('--help') || args.includes('-h')) {
        parseArgs(['--help']);
        process.exit(0);
    }
    const options = parseArgs(args);
    if (!options) {
        process.exit(0);
    }
    const validationError = validateOptions(options);
    if (validationError) {
        console.error(`Error: ${validationError}`);
        process.exit(1);
    }
    console.error('Searching NVD...');
    try {
        const client = new NVDClient(options.apiKey);
        const result = await client.search(options);
        if (!result.vulnerabilities || result.vulnerabilities.length === 0) {
            console.log('No CVEs found matching your criteria.');
            process.exit(0);
        }
        const cves = result.vulnerabilities.map(formatCVE);
        const sortedCves = sortBySeverity(cves);
        const summary = getSummary(sortedCves, result.totalResults);
        if (options.json) {
            console.log(JSON.stringify({
                summary,
                vulnerabilities: sortedCves,
            }, null, 2));
        }
        else {
            console.log(formatTextReport(sortedCves, summary));
        }
        // Exit with non-zero if critical vulnerabilities found
        if (summary.critical > 0) {
            process.exit(1);
        }
    }
    catch (error) {
        console.error(`Error: ${error instanceof Error ? error.message : error}`);
        process.exit(1);
    }
}
main();
// Export for programmatic use
export { NVDClient } from './api.js';
export { formatCVE, sortBySeverity, getSummary, formatTextReport, } from './formatter.js';
//# sourceMappingURL=index.js.map