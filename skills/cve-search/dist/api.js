/**
 * NVD API 2.0 Client
 * Rate limit: 5 requests/30s (public), 50 requests/30s (with API key)
 */
const NVD_API_BASE = 'https://services.nvd.nist.gov/rest/json/cves/2.0';
export class NVDClient {
    apiKey;
    constructor(apiKey = null) {
        this.apiKey = apiKey || process.env.NVD_API_KEY || null;
    }
    async search(options) {
        const params = new URLSearchParams();
        if (options.keyword) {
            params.set('keywordSearch', options.keyword);
        }
        if (options.cveId) {
            params.set('cveId', options.cveId);
        }
        if (options.cweId) {
            // Normalize CWE ID format
            const cweId = options.cweId.replace(/^CWE-/i, '');
            params.set('cweId', `CWE-${cweId}`);
        }
        if (options.severity) {
            params.set('cvssV3Severity', options.severity);
        }
        if (options.days) {
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - options.days);
            params.set('pubStartDate', startDate.toISOString());
            params.set('pubEndDate', endDate.toISOString());
        }
        params.set('resultsPerPage', String(options.limit));
        const url = `${NVD_API_BASE}?${params.toString()}`;
        const headers = {
            Accept: 'application/json',
        };
        if (this.apiKey) {
            headers.apiKey = this.apiKey;
        }
        try {
            const response = await fetch(url, { headers });
            if (!response.ok) {
                if (response.status === 403) {
                    throw new Error('Rate limit exceeded. Wait 30 seconds and try again.');
                }
                throw new Error(`API error: ${response.status} ${response.statusText}`);
            }
            return (await response.json());
        }
        catch (error) {
            if (error instanceof Error && error.message.includes('fetch')) {
                throw new Error('Network error. Check your internet connection.');
            }
            throw error;
        }
    }
}
// Bounty estimate based on severity
export function getBountyEstimate(severity) {
    const estimates = {
        CRITICAL: '$5,000 - $50,000+',
        HIGH: '$2,000 - $10,000',
        MEDIUM: '$500 - $3,000',
        LOW: '$100 - $500',
        UNKNOWN: 'Varies',
    };
    return estimates[severity];
}
//# sourceMappingURL=api.js.map